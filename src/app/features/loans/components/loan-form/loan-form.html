<div #formContainer class="loan-form-container">
  <div class="form-header">
    <h2 class="form-title">ุฏุฑุฎูุงุณุช ูุงู ุฌุฏุฏ</h2>
    <div class="form-icon">๐ธ</div>
  </div>

  <form (ngSubmit)="onSubmit()" #loanForm="ngForm" novalidate class="floating-form">
    <!-- Loan Amount -->
    <div class="form-group" #amountGroup>
      <label for="amount" class="input-label">
        <span class="label-text">ูุจูุบ ูุงู</span>
        <span class="currency-badge">ุชููุงู</span>
      </label>
      <div class="input-container">
        <input
          type="number"
          id="amount"
          name="amount"
          [(ngModel)]="formData.requestedAmount"
          required
          min="1000000"
          #amountInput="ngModel"
          class="glow-input"
          (focus)="onInputFocus(amountGroup)"
          (blur)="onInputBlur(amountGroup)"
          (change)="previewInstallmentSchedule()"
        />
        <div class="input-underline"></div>
      </div>
      <div class="error-message" *ngIf="amountInput.invalid && amountInput.touched">
        <div class="error-icon">โ๏ธ</div>
        ูุจูุบ ุจุงุฏ ุญุฏุงูู ฑ,ฐฐฐ,ฐฐฐ ุชููุงู ุจุงุดุฏ
      </div>
    </div>

    <!-- Loan Purpose -->
    <div class="form-group" #purposeGroup>
      <label for="purpose" class="input-label">ูุฏู ุงุฒ ูุงู</label>
      <div class="input-container">
        <input
          type="text"
          id="purpose"
          name="purpose"
          [(ngModel)]="formData.purpose"
          required
          #purposeInput="ngModel"
          class="glow-input"
          (focus)="onInputFocus(purposeGroup)"
          (blur)="onInputBlur(purposeGroup)"
        />
        <div class="input-underline"></div>
      </div>
      <div class="error-message" *ngIf="purposeInput.invalid && purposeInput.touched">
        <div class="error-icon">โ๏ธ</div>
        ูุทูุงู ูุฏู ูุงู ุฑุง ูุงุฑุฏ ฺฉูุฏ
      </div>
    </div>

    <!-- Installments -->
    <div class="form-group" #installmentsGroup>
      <label for="installments" class="input-label">ุชุนุฏุงุฏ ุงูุณุงุท</label>
      <div class="input-container">
        <input
          type="number"
          id="installments"
          name="installments"
          [(ngModel)]="formData.numberOfInstallments"
          required
          min="3"
          max="36"
          #installmentsInput="ngModel"
          class="glow-input"
          (focus)="onInputFocus(installmentsGroup)"
          (blur)="onInputBlur(installmentsGroup)"
          (change)="previewInstallmentSchedule()"
        />
        <div class="input-underline"></div>
      </div>
      <div class="error-message" *ngIf="installmentsInput.invalid && installmentsInput.touched">
        <div class="error-icon">โ๏ธ</div>
        ุชุนุฏุงุฏ ุงูุณุงุท ุจุงุฏ ุจู ณ ุชุง ณถ ูุงู ุจุงุดุฏ
      </div>
    </div>

    <!-- Installment Schedule Preview -->
    <div *ngIf="showInstallmentSchedule && installmentSchedule" 
         class="schedule-preview" 
         #scheduleContainer>
      <h3 class="schedule-title">ูพุดโููุงุด ุงูุณุงุท ูุงู</h3>
      
      <div class="schedule-summary">
        <div class="summary-item">
          <span class="summary-label">ูุจูุบ ฺฉู ูุงู:</span>
          <span class="summary-value">{{ installmentSchedule.totalAmount | number:'fa-IR' }} ุชููุงู</span>
        </div>
        <div class="summary-item">
          <span class="summary-label">ุณูุฏ ฺฉู:</span>
          <span class="summary-value">{{ installmentSchedule.totalInterest | number:'fa-IR' }} ุชููุงู</span>
        </div>
        <div class="summary-item">
          <span class="summary-label">ุชุนุฏุงุฏ ุงูุณุงุท:</span>
          <span class="summary-value">{{ installmentSchedule.numberOfInstallments }}</span>
        </div>
      </div>
      
      <div class="installment-items">
        <div class="installment-header">
          <div>ุดูุงุฑู ูุณุท</div>
          <div>ุชุงุฑุฎ ุณุฑุฑุณุฏ</div>
          <div>ูุจูุบ ุงุตู</div>
          <div>ุณูุฏ</div>
          <div>ุฌูุน ฺฉู</div>
        </div>
        
        <div *ngFor="let installment of installmentSchedule.installments" 
             class="installment-item">
          <div>{{ installment.number }}</div>
          <div>{{ installment.dueDate | date:'yyyy/MM/dd' }}</div>
          <div>{{ installment.principalAmount | number:'fa-IR' }}</div>
          <div>{{ installment.interestAmount | number:'fa-IR' }}</div>
          <div>{{ installment.totalAmount | number:'fa-IR' }}</div>
        </div>
      </div>
    </div>

    <!-- Submit Button -->
    <button
      type="submit"
      #submitBtn
      [disabled]="loanForm.invalid || !userId || isSubmitting"
      class="btn-submit floating-btn"
      (mouseenter)="onButtonHover()"
      (mouseleave)="onButtonLeave()"
    >
      <span class="btn-text">{{ isSubmitting ? 'ุฏุฑ ุญุงู ุงุฑุณุงู...' : 'ุงุฑุณุงู ุฏุฑุฎูุงุณุช' }}</span>
      <span class="btn-icon">{{ isSubmitting ? 'โณ' : '๐' }}</span>
    </button>
  </form>

  <!-- Background Effects -->
  <div class="background-effects">
    <div class="particle"></div>
    <div class="particle"></div>
    <div class="particle"></div>
  </div>
</div>